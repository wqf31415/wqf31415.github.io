---
title: JVM 调优初探
date: 2019-01-11 09:58:19
tags:
- java
- jvm
categories:
- 技术
---

### 简介
初次接触到 JVM 调优，在本文中记录了相关的概念、方法与工具使用。


### 遇到的问题
> 线上运行的项目，在一次更新时配置出错，没有开启数据消费线程，导致消息队列中积压了超四百万条数据，修改配置后再运行时，发现服务器 cpu 占用率长时间达到 100%，消息队列中不断积压数据，后台无法访问。


### 思路
1. 这台服务器是虚拟机，发现服务器尽然是单核 cpu 的，多分配 cpu 应该可以提高程序运行效率；
2. 项目正常运行时，消息队列消费速度快，不会积压，或是有少量积压也能迅速消费掉，这次由于意外导致消息队列积压数据太多，最终导致程序无法消费；
3. 怀疑消息消费代码效率太低，测试发现在消息积压过多时，消费速度严重下降，可能是线程太多，处理不过来；
4. 检查代码发现，应用开启后不断的从消息队列拿数据，生成任务对象放到了一个 LinkedBlockingQueue 中，这个 queue 没有指定容量，使用的是最大容量 Integer.MAX_VALUE ，怀疑是放入了太多的数据，把内存占满了；


